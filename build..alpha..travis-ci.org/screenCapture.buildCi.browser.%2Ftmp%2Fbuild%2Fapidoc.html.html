<html><head></head><body><div class="apidocDiv">
<style>
/*csslint
*/
.apidocDiv {
    background: #fff;
    font-family: Arial, Helvetica, sans-serif;
}
.apidocDiv a[href] {
    color: #33f;
    font-weight: bold;
    text-decoration: none;
}
.apidocDiv a[href]:hover {
    text-decoration: underline;
}
.apidocCodeCommentSpan {
    background: #bbf;
    color: #000;
    display: block;
}
.apidocCodeKeywordSpan {
    color: #d00;
    font-weight: bold;
}
.apidocCodePre {
    background: #eef;
    border: 1px solid;
    color: #777;
    padding: 5px;
    white-space: pre-wrap;
}
.apidocFooterDiv {
    margin-top: 20px;
    text-align: center;
}
.apidocModuleLi {
    margin-top: 10px;
}
.apidocSectionDiv {
    border-top: 1px solid;
    margin-top: 20px;
}
.apidocSignatureSpan {
    color: #777;
    font-weight: bold;
}
</style>
<h1>api documentation for
    <a href="https://github.com/jwtk/njwt">njwt (v0.4.0)</a>
</h1>
<h4>JWT Library for Node.js</h4>
<div class="apidocSectionDiv"><a href="#apidoc.tableOfContents" id="apidoc.tableOfContents"><h1>table of contents</h1></a><ol>

    <li class="apidocModuleLi"><a href="#apidoc.module.njwt">module njwt</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.njwt.Jwt">
            function <span class="apidocSignatureSpan">njwt.</span>Jwt
            <span class="apidocSignatureSpan">(claims, enforceDefaultFields)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.njwt.JwtBody">
            function <span class="apidocSignatureSpan">njwt.</span>JwtBody
            <span class="apidocSignatureSpan">(claims)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.njwt.JwtHeader">
            function <span class="apidocSignatureSpan">njwt.</span>JwtHeader
            <span class="apidocSignatureSpan">(header)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.njwt.Verifier">
            function <span class="apidocSignatureSpan">njwt.</span>Verifier
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.njwt.base64urlEncode">
            function <span class="apidocSignatureSpan">njwt.</span>base64urlEncode
            <span class="apidocSignatureSpan">(str)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.njwt.base64urlUnescape">
            function <span class="apidocSignatureSpan">njwt.</span>base64urlUnescape
            <span class="apidocSignatureSpan">(str)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.njwt.create">
            function <span class="apidocSignatureSpan">njwt.</span>create
            <span class="apidocSignatureSpan">(claims, secret, alg)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.njwt.createVerifier">
            function <span class="apidocSignatureSpan">njwt.</span>createVerifier
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.njwt.verify">
            function <span class="apidocSignatureSpan">njwt.</span>verify
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">njwt.</span>Jwt.prototype</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">njwt.</span>JwtBody.prototype</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">njwt.</span>JwtHeader.prototype</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">njwt.</span>Verifier.prototype</span>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.njwt.Jwt">module njwt.Jwt</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.njwt.Jwt.Jwt">
            function <span class="apidocSignatureSpan">njwt.</span>Jwt
            <span class="apidocSignatureSpan">(claims, enforceDefaultFields)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.njwt.Jwt.prototype">module njwt.Jwt.prototype</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.njwt.Jwt.prototype.compact">
            function <span class="apidocSignatureSpan">njwt.Jwt.prototype.</span>compact
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.njwt.Jwt.prototype.isExpired">
            function <span class="apidocSignatureSpan">njwt.Jwt.prototype.</span>isExpired
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.njwt.Jwt.prototype.isNotBefore">
            function <span class="apidocSignatureSpan">njwt.Jwt.prototype.</span>isNotBefore
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.njwt.Jwt.prototype.isSupportedAlg">
            function <span class="apidocSignatureSpan">njwt.Jwt.prototype.</span>isSupportedAlg
            <span class="apidocSignatureSpan">(alg)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.njwt.Jwt.prototype.setClaim">
            function <span class="apidocSignatureSpan">njwt.Jwt.prototype.</span>setClaim
            <span class="apidocSignatureSpan">(claim, value)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.njwt.Jwt.prototype.setExpiration">
            function <span class="apidocSignatureSpan">njwt.Jwt.prototype.</span>setExpiration
            <span class="apidocSignatureSpan">(exp)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.njwt.Jwt.prototype.setHeader">
            function <span class="apidocSignatureSpan">njwt.Jwt.prototype.</span>setHeader
            <span class="apidocSignatureSpan">(param, value)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.njwt.Jwt.prototype.setIssuedAt">
            function <span class="apidocSignatureSpan">njwt.Jwt.prototype.</span>setIssuedAt
            <span class="apidocSignatureSpan">(iat)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.njwt.Jwt.prototype.setIssuer">
            function <span class="apidocSignatureSpan">njwt.Jwt.prototype.</span>setIssuer
            <span class="apidocSignatureSpan">(iss)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.njwt.Jwt.prototype.setJti">
            function <span class="apidocSignatureSpan">njwt.Jwt.prototype.</span>setJti
            <span class="apidocSignatureSpan">(jti)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.njwt.Jwt.prototype.setNotBefore">
            function <span class="apidocSignatureSpan">njwt.Jwt.prototype.</span>setNotBefore
            <span class="apidocSignatureSpan">(nbf)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.njwt.Jwt.prototype.setSigningAlgorithm">
            function <span class="apidocSignatureSpan">njwt.Jwt.prototype.</span>setSigningAlgorithm
            <span class="apidocSignatureSpan">(alg)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.njwt.Jwt.prototype.setSigningKey">
            function <span class="apidocSignatureSpan">njwt.Jwt.prototype.</span>setSigningKey
            <span class="apidocSignatureSpan">(key)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.njwt.Jwt.prototype.setSubject">
            function <span class="apidocSignatureSpan">njwt.Jwt.prototype.</span>setSubject
            <span class="apidocSignatureSpan">(sub)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.njwt.Jwt.prototype.sign">
            function <span class="apidocSignatureSpan">njwt.Jwt.prototype.</span>sign
            <span class="apidocSignatureSpan">(payload, algorithm, cryptoInput)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.njwt.Jwt.prototype.toString">
            function <span class="apidocSignatureSpan">njwt.Jwt.prototype.</span>toString
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.njwt.JwtBody">module njwt.JwtBody</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.njwt.JwtBody.JwtBody">
            function <span class="apidocSignatureSpan">njwt.</span>JwtBody
            <span class="apidocSignatureSpan">(claims)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.njwt.JwtBody.prototype">module njwt.JwtBody.prototype</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.njwt.JwtBody.prototype.compact">
            function <span class="apidocSignatureSpan">njwt.JwtBody.prototype.</span>compact
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.njwt.JwtBody.prototype.toJSON">
            function <span class="apidocSignatureSpan">njwt.JwtBody.prototype.</span>toJSON
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.njwt.JwtHeader">module njwt.JwtHeader</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.njwt.JwtHeader.JwtHeader">
            function <span class="apidocSignatureSpan">njwt.</span>JwtHeader
            <span class="apidocSignatureSpan">(header)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.njwt.JwtHeader.prototype">module njwt.JwtHeader.prototype</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.njwt.JwtHeader.prototype.compact">
            function <span class="apidocSignatureSpan">njwt.JwtHeader.prototype.</span>compact
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">njwt.JwtHeader.prototype.</span>reservedKeys</span>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.njwt.Verifier">module njwt.Verifier</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.njwt.Verifier.Verifier">
            function <span class="apidocSignatureSpan">njwt.</span>Verifier
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.njwt.Verifier.prototype">module njwt.Verifier.prototype</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.njwt.Verifier.prototype.isSupportedAlg">
            function <span class="apidocSignatureSpan">njwt.Verifier.prototype.</span>isSupportedAlg
            <span class="apidocSignatureSpan">(alg)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.njwt.Verifier.prototype.setKeyResolver">
            function <span class="apidocSignatureSpan">njwt.Verifier.prototype.</span>setKeyResolver
            <span class="apidocSignatureSpan">(keyResolver)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.njwt.Verifier.prototype.setSigningAlgorithm">
            function <span class="apidocSignatureSpan">njwt.Verifier.prototype.</span>setSigningAlgorithm
            <span class="apidocSignatureSpan">(alg)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.njwt.Verifier.prototype.setSigningKey">
            function <span class="apidocSignatureSpan">njwt.Verifier.prototype.</span>setSigningKey
            <span class="apidocSignatureSpan">(keyStr)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.njwt.Verifier.prototype.verify">
            function <span class="apidocSignatureSpan">njwt.Verifier.prototype.</span>verify
            <span class="apidocSignatureSpan">(jwtString, cb)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.njwt.Verifier.prototype.withKeyResolver">
            function <span class="apidocSignatureSpan">njwt.Verifier.prototype.</span>withKeyResolver
            <span class="apidocSignatureSpan">(keyResolver)</span>
            </a>

        </li>

    </ol></li>

</ol></div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.njwt" id="apidoc.module.njwt">module njwt</a></h1>


    <h2>
        <a href="#apidoc.element.njwt.Jwt" id="apidoc.element.njwt.Jwt">
        function <span class="apidocSignatureSpan">njwt.</span>Jwt
        <span class="apidocSignatureSpan">(claims, enforceDefaultFields)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function Jwt(claims, enforceDefaultFields){
  if(!(this instanceof Jwt)){
    return new Jwt(claims, enforceDefaultFields);
  }

  this.header = new JwtHeader();
  this.body = new JwtBody(claims);

  if (enforceDefaultFields !== false) {
    this.setSigningAlgorithm('none');

    if (!this.body.jti) {
      this.setJti(uuid.v4());
    }

    if (!this.body.iat) {
      this.setIssuedAt(nowEpochSeconds());
    }
  }

  return this;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
var properties = require('../properties.json');

describe('Jwt()',function(){
  describe('signWith()',function(){
    describe('if called with an unsupported algorithm',function(){
      it('should throw',function(){
        assert.throws(function(){
          new nJwt.<span class="apidocCodeKeywordSpan">Jwt</span>().setSigningAlgorithm('unsupported');
        },properties.errors.UNSUPPORTED_SIGNING_ALG);
      });
    });
  });

});
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.njwt.JwtBody" id="apidoc.element.njwt.JwtBody">
        function <span class="apidocSignatureSpan">njwt.</span>JwtBody
        <span class="apidocSignatureSpan">(claims)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function JwtBody(claims){
  if(!(this instanceof JwtBody)){
    return new JwtBody(claims);
  }
  var self = this;
  if(claims){
    Object.keys(claims).forEach(function(k){
      self[k] = claims[k];
    });
  }
  return this;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...



var assert = require('assert');
var nJwt = require('../');
describe('JwtBody',function() {
  it('should construct itself if called without new',function(){
    assert(nJwt.<span class="apidocCodeKeywordSpan">JwtBody</span>() instanceof nJwt.JwtBody);
  });
});
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.njwt.JwtHeader" id="apidoc.element.njwt.JwtHeader">
        function <span class="apidocSignatureSpan">njwt.</span>JwtHeader
        <span class="apidocSignatureSpan">(header)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function JwtHeader(header){
  if(!(this instanceof JwtHeader)){
    return new JwtHeader(header);
  }
  var self = this;
  this.typ = header &amp;&amp; header.typ || 'JWT';
  this.alg = header &amp;&amp; header.alg || 'HS256';

  if(header){
    return Object.keys(header).reduce(function(acc,key){
      if(self.reservedKeys.indexOf(key)===-1 &amp;&amp; header.hasOwnProperty(key)){
        acc[key] = header[key];
      }
      return acc;
    },this);
  }else{
    return this;
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  nJwt.verify(invalidJwt,function(err){
    assert.equal(err.jwtString, invalidJwt);
    done();
  });
});

it('should return PARSE_ERROR if the body is not JSON',function(){
  var header = nJwt.<span class="apidocCodeKeywordSpan">JwtHeader</span>({type:'JWT',alg:'HS256'}).compact();
  assert.throws(function(){
    nJwt.verify(header+".notavalidbody");
  },properties.errors.PARSE_ERROR);
});

it('should give me the parsed header on the error object if the body fails',function(done){
  var header = nJwt.JwtHeader({typ:'JWT',alg:uuid()});
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.njwt.Verifier" id="apidoc.element.njwt.Verifier">
        function <span class="apidocSignatureSpan">njwt.</span>Verifier
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function Verifier(){
  if(!(this instanceof Verifier)){
    return new Verifier();
  }
  this.setSigningAlgorithm('HS256');
  this.setKeyResolver(defaultKeyResolver.bind(this));
  return this;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
var uuid = require('uuid');

var nJwt = require('../');
var properties = require('../properties.json');

describe('Verifier', function() {
  it('should construct itself if called without new', function() {
assert(nJwt.<span class="apidocCodeKeywordSpan">Verifier</span>() instanceof nJwt.Verifier);
  });

  describe('.withKeyResolver()', function() {
var resolver;

before(function() {
  resolver = function() {};
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.njwt.base64urlEncode" id="apidoc.element.njwt.base64urlEncode">
        function <span class="apidocSignatureSpan">njwt.</span>base64urlEncode
        <span class="apidocSignatureSpan">(str)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function base64urlEncode(str) {
  return new Buffer(str)
    .toString('base64')
    .replace(/\+/g, '-')
    .replace(/\//g, '_')
    .replace(/=/g, '');
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
});

describe('base64 URL Encoding',function(){
  it('should do what rfc7515 says',function(){
var key = "AyM1SysPpbyDfgZld3umj1qzKObwVMkoqQ-EstJQLr_T-1qS0gZH75aKtMN3Yj0iPS4hcgUuTwjAzZr1Z9CAow";
var headerString = '{"typ":"JWT",\r\n "alg":"HS256"}';
var payloadString = '{"iss":"joe",\r\n "exp":1300819380,\r\n "http://example.com/is_root
":true}';
var compactHeader = nJwt.<span class="apidocCodeKeywordSpan">base64urlEncode</span>(headerString);
var compactBody = nJwt.base64urlEncode(payloadString);
assert.equal(
  compactHeader,
  'eyJ0eXAiOiJKV1QiLA0KICJhbGciOiJIUzI1NiJ9'
);

assert.equal(
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.njwt.base64urlUnescape" id="apidoc.element.njwt.base64urlUnescape">
        function <span class="apidocSignatureSpan">njwt.</span>base64urlUnescape
        <span class="apidocSignatureSpan">(str)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function base64urlUnescape(str) {
  str += new Array(5 - str.length % 4).join('=');
  return str.replace(/\-/g, '+').replace(/_/g, '/');
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.njwt.create" id="apidoc.element.njwt.create">
        function <span class="apidocSignatureSpan">njwt.</span>create
        <span class="apidocSignatureSpan">(claims, secret, alg)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">create = function (claims, secret, alg){
  var args = Array.prototype.slice.call(arguments);
  var jwt;
  if(args.length &gt;= 2){
    jwt = new Jwt(claims);
  }else if (args.length===1 &amp;&amp; typeof claims === 'string'){
    jwt = new Jwt({});
    secret = claims;
  }else{
    jwt = new Jwt(claims);
  }
  if(alg!=='none' &amp;&amp; !secret){
    throw new Error(properties.errors.SIGNING_KEY_REQUIRED);
  }else{
    jwt.setSigningAlgorithm(args.length===3 ? alg : 'HS256');
    jwt.setSigningKey(secret);
  }
  jwt.setExpiration((nowEpochSeconds() + (60*60))*1000); // one hour
  return jwt;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

var claims = {
  iss: "http://myapp.com/",  // The URL of your service
  sub: "users/user1234",    // The UID of the user in your system
  scope: "self, admins"
}

var jwt = nJwt.<span class="apidocCodeKeywordSpan">create</span>(claims,signingKey);

````

Once you have created the JWT, you can look at its internal structure by
logging it to the console.  This is our internal representation of the token,
this is not what you'll send to your end user:
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.njwt.createVerifier" id="apidoc.element.njwt.createVerifier">
        function <span class="apidocSignatureSpan">njwt.</span>createVerifier
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">createVerifier = function (){
  return new Verifier();
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...



# nJwt Change Log

### 0.4.0

* Added a key resolver interface, use `nJwt.<span class="apidocCodeKeywordSpan">createVerifier</span>().withKeyResolver(function
(kid, cb){ })`
* Added `jwt.setClaim(claim, value)` and `jwt.setHeader(param, value)` for setting body claims and header values in a chain-able
 way.

### 0.3.2

Added support for the `nbf`, "not before", claim.

### 0.3.1
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.njwt.verify" id="apidoc.element.njwt.verify">
        function <span class="apidocSignatureSpan">njwt.</span>verify
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">verify = function (){

  var args = Array.prototype.slice.call(arguments);
  var cb = typeof args[args.length-1] === 'function' ? args.pop() : null;

  var verifier = new Verifier();

  if(args.length===3){
    verifier.setSigningAlgorithm(args[2]);
    verifier.setSigningKey(args[1]);
  }

  if(args.length===2){
    verifier.setSigningKey(args[1]);
  }

  if(args.length===1){
    verifier.setSigningAlgorithm('none');
  }

  return verifier.verify(args[0], cb);

}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

### 0.3.1

Fixed to support proper signing and verification of ECDSA signatures.

### 0.3.0

The JWTs that are returned by `nJwt.<span class="apidocCodeKeywordSpan">verify</span>()` and `nJwt.parse()` will no longer
populate the `iat` and `jti` fields with default random values.

### 0.2.3

Fixed to prevent the `jti` and `iat` claims of the passed token from being
over-written with default random values during verification.
...</pre></li>
    </ul>










</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.njwt.Jwt" id="apidoc.module.njwt.Jwt">module njwt.Jwt</a></h1>


    <h2>
        <a href="#apidoc.element.njwt.Jwt.Jwt" id="apidoc.element.njwt.Jwt.Jwt">
        function <span class="apidocSignatureSpan">njwt.</span>Jwt
        <span class="apidocSignatureSpan">(claims, enforceDefaultFields)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function Jwt(claims, enforceDefaultFields){
  if(!(this instanceof Jwt)){
    return new Jwt(claims, enforceDefaultFields);
  }

  this.header = new JwtHeader();
  this.body = new JwtBody(claims);

  if (enforceDefaultFields !== false) {
    this.setSigningAlgorithm('none');

    if (!this.body.jti) {
      this.setJti(uuid.v4());
    }

    if (!this.body.iat) {
      this.setIssuedAt(nowEpochSeconds());
    }
  }

  return this;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
var properties = require('../properties.json');

describe('Jwt()',function(){
  describe('signWith()',function(){
    describe('if called with an unsupported algorithm',function(){
      it('should throw',function(){
        assert.throws(function(){
          new nJwt.<span class="apidocCodeKeywordSpan">Jwt</span>().setSigningAlgorithm('unsupported');
        },properties.errors.UNSUPPORTED_SIGNING_ALG);
      });
    });
  });

});
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.njwt.Jwt.prototype" id="apidoc.module.njwt.Jwt.prototype">module njwt.Jwt.prototype</a></h1>


    <h2>
        <a href="#apidoc.element.njwt.Jwt.prototype.compact" id="apidoc.element.njwt.Jwt.prototype.compact">
        function <span class="apidocSignatureSpan">njwt.Jwt.prototype.</span>compact
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function compact() {

  var segments = [];
  segments.push(this.header.compact());
  segments.push(this.body.compact());

  if(this.header.alg !== 'none'){
    if (this.signingKey) {
      this.signature = this.sign(segments.join('.'), this.header.alg, this.signingKey);
      segments.push(this.signature);
    }else{
      throw new Error(properties.errors.SIGNING_KEY_REQUIRED);
    }
  }

  return segments.join('.');
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
### 0.2.3

Fixed to prevent the `jti` and `iat` claims of the passed token from being
over-written with default random values during verification.

### 0.2.2

`jwt.toString()` is now an alias for `jwt.<span class="apidocCodeKeywordSpan">compact</span>()`.

### 0.2.1

When parsing a JWT string, the header values of the JWT are now populated on the
object that is returned.

### 0.2.0
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.njwt.Jwt.prototype.isExpired" id="apidoc.element.njwt.Jwt.prototype.isExpired">
        function <span class="apidocSignatureSpan">njwt.Jwt.prototype.</span>isExpired
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">isExpired = function () {
  return new Date(this.body.exp*1000) &lt; new Date();
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
var cryptoAlgName = algCryptoMap[header.alg];
var signingType = algTypeMap[header.alg];

if (header.alg !== this.signingAlgorithm) {
  return done(new JwtParseError(properties.errors.SIGNATURE_ALGORITHM_MISMTACH,jwtString,header,body));
}

if (jwt.<span class="apidocCodeKeywordSpan">isExpired</span>()) {
  return done(new JwtParseError(properties.errors.EXPIRED,jwtString,header,body));
}

if (jwt.isNotBefore()) {
  return done(new JwtParseError(properties.errors.NOT_ACTIVE,jwtString,header,body));
}
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.njwt.Jwt.prototype.isNotBefore" id="apidoc.element.njwt.Jwt.prototype.isNotBefore">
        function <span class="apidocSignatureSpan">njwt.Jwt.prototype.</span>isNotBefore
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">isNotBefore = function () {
  return new Date(this.body.nbf * 1000) &gt;= new Date();
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  return done(new JwtParseError(properties.errors.SIGNATURE_ALGORITHM_MISMTACH,jwtString,header,body));
}

if (jwt.isExpired()) {
  return done(new JwtParseError(properties.errors.EXPIRED,jwtString,header,body));
}

if (jwt.<span class="apidocCodeKeywordSpan">isNotBefore</span>()) {
  return done(new JwtParseError(properties.errors.NOT_ACTIVE,jwtString,header,body));
}

var digstInput = jwt.verificationInput;
var verified, digest;

return this.keyResolver(header.kid, function(err, signingKey) {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.njwt.Jwt.prototype.isSupportedAlg" id="apidoc.element.njwt.Jwt.prototype.isSupportedAlg">
        function <span class="apidocSignatureSpan">njwt.Jwt.prototype.</span>isSupportedAlg
        <span class="apidocSignatureSpan">(alg)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function isSupportedAlg(alg){
  return !!algCryptoMap[alg];
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  return this;
};
Jwt.prototype.setSigningKey = function setSigningKey(key) {
  this.signingKey = key;
  return this;
};
Jwt.prototype.setSigningAlgorithm = function setSigningAlgorithm(alg) {
  if(!this.<span class="apidocCodeKeywordSpan">isSupportedAlg</span>(alg)){
    throw new JwtError(properties.errors.UNSUPPORTED_SIGNING_ALG);
  }
  this.header.alg = alg;
  return this;
};

Jwt.prototype.sign = function sign(payload, algorithm, cryptoInput) {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.njwt.Jwt.prototype.setClaim" id="apidoc.element.njwt.Jwt.prototype.setClaim">
        function <span class="apidocSignatureSpan">njwt.Jwt.prototype.</span>setClaim
        <span class="apidocSignatureSpan">(claim, value)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function setClaim(claim, value) {
  this.body[claim] = value;
  return this;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...


# nJwt Change Log

### 0.4.0

* Added a key resolver interface, use `nJwt.createVerifier().withKeyResolver(function(kid, cb){ })`
* Added `jwt.<span class="apidocCodeKeywordSpan">setClaim</span>(claim, value)` and `jwt.setHeader(param, value)` for setting body
 claims and header values in a chain-able way.

### 0.3.2

Added support for the `nbf`, "not before", claim.

### 0.3.1
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.njwt.Jwt.prototype.setExpiration" id="apidoc.element.njwt.Jwt.prototype.setExpiration">
        function <span class="apidocSignatureSpan">njwt.Jwt.prototype.</span>setExpiration
        <span class="apidocSignatureSpan">(exp)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function setExpiration(exp) {
  if(exp){
    this.body.exp = Math.floor((exp instanceof Date ? exp : new Date(exp)).getTime() / 1000);
  }else{
    delete this.body.exp;
  }

  return this;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    }
    if(alg!=='none' &amp;&amp; !secret){
      throw new Error(properties.errors.SIGNING_KEY_REQUIRED);
    }else{
      jwt.setSigningAlgorithm(args.length===3 ? alg : 'HS256');
      jwt.setSigningKey(secret);
    }
    jwt.<span class="apidocCodeKeywordSpan">setExpiration</span>((nowEpochSeconds() + (60*60))*1000); // one hour
    return jwt;
  }
};

module.exports = jwtLib;
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.njwt.Jwt.prototype.setHeader" id="apidoc.element.njwt.Jwt.prototype.setHeader">
        function <span class="apidocSignatureSpan">njwt.Jwt.prototype.</span>setHeader
        <span class="apidocSignatureSpan">(param, value)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function setHeader(param, value) {
  this.header[param] = value;
  return this;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...


# nJwt Change Log

### 0.4.0

* Added a key resolver interface, use `nJwt.createVerifier().withKeyResolver(function(kid, cb){ })`
* Added `jwt.setClaim(claim, value)` and `jwt.<span class="apidocCodeKeywordSpan">setHeader</span>(param, value)` for setting body
 claims and header values in a chain-able way.

### 0.3.2

Added support for the `nbf`, "not before", claim.

### 0.3.1
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.njwt.Jwt.prototype.setIssuedAt" id="apidoc.element.njwt.Jwt.prototype.setIssuedAt">
        function <span class="apidocSignatureSpan">njwt.Jwt.prototype.</span>setIssuedAt
        <span class="apidocSignatureSpan">(iat)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function setIssuedAt(iat) {
  this.body.iat = iat;
  return this;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  this.setSigningAlgorithm('none');

  if (!this.body.jti) {
    this.setJti(uuid.v4());
  }

  if (!this.body.iat) {
    this.<span class="apidocCodeKeywordSpan">setIssuedAt</span>(nowEpochSeconds());
  }
}

return this;
}
Jwt.prototype.setClaim = function setClaim(claim, value) {
this.body[claim] = value;
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.njwt.Jwt.prototype.setIssuer" id="apidoc.element.njwt.Jwt.prototype.setIssuer">
        function <span class="apidocSignatureSpan">njwt.Jwt.prototype.</span>setIssuer
        <span class="apidocSignatureSpan">(iss)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function setIssuer(iss) {
  this.body.iss = iss;
  return this;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
describe('.setSubject()',function(){
  it('should set the sub claim',function(){
    var sub = uuid();
    assert.equal(nJwt.Jwt().setSubject(sub).body.sub,sub);
  });
});

describe('.<span class="apidocCodeKeywordSpan">setIssuer</span>()',function(){
  it('should set the iss claim',function(){
    var iss = uuid();
    assert.equal(nJwt.Jwt().setIssuer(iss).body.iss,iss);
  });
});

describe('.setExpiration()',function(){
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.njwt.Jwt.prototype.setJti" id="apidoc.element.njwt.Jwt.prototype.setJti">
        function <span class="apidocSignatureSpan">njwt.Jwt.prototype.</span>setJti
        <span class="apidocSignatureSpan">(jti)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function setJti(jti) {
  this.body.jti = jti;
  return this;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
this.header = new JwtHeader();
this.body = new JwtBody(claims);

if (enforceDefaultFields !== false) {
  this.setSigningAlgorithm('none');

  if (!this.body.jti) {
    this.<span class="apidocCodeKeywordSpan">setJti</span>(uuid.v4());
  }

  if (!this.body.iat) {
    this.setIssuedAt(nowEpochSeconds());
  }
}
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.njwt.Jwt.prototype.setNotBefore" id="apidoc.element.njwt.Jwt.prototype.setNotBefore">
        function <span class="apidocSignatureSpan">njwt.Jwt.prototype.</span>setNotBefore
        <span class="apidocSignatureSpan">(nbf)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function setNotBefore(nbf) {
  if(nbf) {
    this.body.nbf = Math.floor((nbf instanceof Date ? nbf : new Date(nbf)).getTime() / 1000);
  } else {
    delete this.body.nbf;
  }

  return this;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    assert.equal(jwt.setExpiration(false).body.exp, undefined);
    assert.equal(jwt.setExpiration(null).body.exp, undefined);
    assert.equal(jwt.setExpiration(0).body.exp, undefined);
  });
});


describe('.<span class="apidocCodeKeywordSpan">setNotBefore</span>()',function(){
  it('should accept Date types and set the nbf claim to a UNIX timestamp value',function(){
    var future = new Date('2025');
    assert.equal(
      nJwt.Jwt().setNotBefore(future).body.nbf,
      future.getTime()/1000
    );
  });
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.njwt.Jwt.prototype.setSigningAlgorithm" id="apidoc.element.njwt.Jwt.prototype.setSigningAlgorithm">
        function <span class="apidocSignatureSpan">njwt.Jwt.prototype.</span>setSigningAlgorithm
        <span class="apidocSignatureSpan">(alg)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function setSigningAlgorithm(alg) {
  if(!this.isSupportedAlg(alg)){
    throw new JwtError(properties.errors.UNSUPPORTED_SIGNING_ALG);
  }
  this.header.alg = alg;
  return this;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
return new Jwt(claims, enforceDefaultFields);
  }

  this.header = new JwtHeader();
  this.body = new JwtBody(claims);

  if (enforceDefaultFields !== false) {
this.<span class="apidocCodeKeywordSpan">setSigningAlgorithm</span>('none');

if (!this.body.jti) {
  this.setJti(uuid.v4());
}

if (!this.body.iat) {
  this.setIssuedAt(nowEpochSeconds());
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.njwt.Jwt.prototype.setSigningKey" id="apidoc.element.njwt.Jwt.prototype.setSigningKey">
        function <span class="apidocSignatureSpan">njwt.Jwt.prototype.</span>setSigningKey
        <span class="apidocSignatureSpan">(key)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function setSigningKey(key) {
  this.signingKey = key;
  return this;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
var args = Array.prototype.slice.call(arguments);
var cb = typeof args[args.length-1] === 'function' ? args.pop() : null;

var verifier = new Verifier();

if(args.length===3){
  verifier.setSigningAlgorithm(args[2]);
  verifier.<span class="apidocCodeKeywordSpan">setSigningKey</span>(args[1]);
}

if(args.length===2){
  verifier.setSigningKey(args[1]);
}

if(args.length===1){
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.njwt.Jwt.prototype.setSubject" id="apidoc.element.njwt.Jwt.prototype.setSubject">
        function <span class="apidocSignatureSpan">njwt.Jwt.prototype.</span>setSubject
        <span class="apidocSignatureSpan">(sub)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function setSubject(sub) {
  this.body.sub = sub;
  return this;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
describe('.setHeader()',function(){
  it('should set a header param on the header',function(){
    var kid = uuid();
    assert.equal(nJwt.Jwt().setHeader('kid', kid).header.kid,kid);
  });
});

describe('.<span class="apidocCodeKeywordSpan">setSubject</span>()',function(){
  it('should set the sub claim',function(){
    var sub = uuid();
    assert.equal(nJwt.Jwt().setSubject(sub).body.sub,sub);
  });
});

describe('.setIssuer()',function(){
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.njwt.Jwt.prototype.sign" id="apidoc.element.njwt.Jwt.prototype.sign">
        function <span class="apidocSignatureSpan">njwt.Jwt.prototype.</span>sign
        <span class="apidocSignatureSpan">(payload, algorithm, cryptoInput)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function sign(payload, algorithm, cryptoInput) {
  var buffer;
  var signature;
  var cryptoAlgName = algCryptoMap[algorithm];
  var signingType = algTypeMap[algorithm];

  if (!cryptoAlgName) {
    throw new JwtError(properties.errors.UNSUPPORTED_SIGNING_ALG);
  }

  if (signingType === 'hmac') {
    buffer = crypto.createHmac(cryptoAlgName, cryptoInput).update(payload).digest();
  } else {
    buffer = crypto.createSign(cryptoAlgName).update(payload).sign(cryptoInput);
  }

  if (isECDSA(algorithm)) {
    signature = ecdsaSigFormatter.derToJose(buffer, algorithm);
  } else {
    signature = base64urlEncode(buffer);
  }

  return signature;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
if (!cryptoAlgName) {
  throw new JwtError(properties.errors.UNSUPPORTED_SIGNING_ALG);
}

if (signingType === 'hmac') {
  buffer = crypto.createHmac(cryptoAlgName, cryptoInput).update(payload).digest();
} else {
  buffer = crypto.createSign(cryptoAlgName).update(payload).<span class="apidocCodeKeywordSpan">sign</span>(cryptoInput);
}

if (isECDSA(algorithm)) {
  signature = ecdsaSigFormatter.derToJose(buffer, algorithm);
} else {
  signature = base64urlEncode(buffer);
}
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.njwt.Jwt.prototype.toString" id="apidoc.element.njwt.Jwt.prototype.toString">
        function <span class="apidocSignatureSpan">njwt.Jwt.prototype.</span>toString
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">toString = function (){
  return this.compact();
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
### 0.2.3

Fixed to prevent the `jti` and `iat` claims of the passed token from being
over-written with default random values during verification.

### 0.2.2

`jwt.<span class="apidocCodeKeywordSpan">toString</span>()` is now an alias for `jwt.compact()`.

### 0.2.1

When parsing a JWT string, the header values of the JWT are now populated on the
object that is returned.

### 0.2.0
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.njwt.JwtBody" id="apidoc.module.njwt.JwtBody">module njwt.JwtBody</a></h1>


    <h2>
        <a href="#apidoc.element.njwt.JwtBody.JwtBody" id="apidoc.element.njwt.JwtBody.JwtBody">
        function <span class="apidocSignatureSpan">njwt.</span>JwtBody
        <span class="apidocSignatureSpan">(claims)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function JwtBody(claims){
  if(!(this instanceof JwtBody)){
    return new JwtBody(claims);
  }
  var self = this;
  if(claims){
    Object.keys(claims).forEach(function(k){
      self[k] = claims[k];
    });
  }
  return this;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...



var assert = require('assert');
var nJwt = require('../');
describe('JwtBody',function() {
  it('should construct itself if called without new',function(){
    assert(nJwt.<span class="apidocCodeKeywordSpan">JwtBody</span>() instanceof nJwt.JwtBody);
  });
});
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.njwt.JwtBody.prototype" id="apidoc.module.njwt.JwtBody.prototype">module njwt.JwtBody.prototype</a></h1>


    <h2>
        <a href="#apidoc.element.njwt.JwtBody.prototype.compact" id="apidoc.element.njwt.JwtBody.prototype.compact">
        function <span class="apidocSignatureSpan">njwt.JwtBody.prototype.</span>compact
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function compact(){
  return base64urlEncode(JSON.stringify(this));
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
### 0.2.3

Fixed to prevent the `jti` and `iat` claims of the passed token from being
over-written with default random values during verification.

### 0.2.2

`jwt.toString()` is now an alias for `jwt.<span class="apidocCodeKeywordSpan">compact</span>()`.

### 0.2.1

When parsing a JWT string, the header values of the JWT are now populated on the
object that is returned.

### 0.2.0
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.njwt.JwtBody.prototype.toJSON" id="apidoc.element.njwt.JwtBody.prototype.toJSON">
        function <span class="apidocSignatureSpan">njwt.JwtBody.prototype.</span>toJSON
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">toJSON = function () {
  var self = this;
  return Object.keys(self).reduce(function(acc,key){
    acc[key] = self[key];
    return acc;
  },{});
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.njwt.JwtHeader" id="apidoc.module.njwt.JwtHeader">module njwt.JwtHeader</a></h1>


    <h2>
        <a href="#apidoc.element.njwt.JwtHeader.JwtHeader" id="apidoc.element.njwt.JwtHeader.JwtHeader">
        function <span class="apidocSignatureSpan">njwt.</span>JwtHeader
        <span class="apidocSignatureSpan">(header)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function JwtHeader(header){
  if(!(this instanceof JwtHeader)){
    return new JwtHeader(header);
  }
  var self = this;
  this.typ = header &amp;&amp; header.typ || 'JWT';
  this.alg = header &amp;&amp; header.alg || 'HS256';

  if(header){
    return Object.keys(header).reduce(function(acc,key){
      if(self.reservedKeys.indexOf(key)===-1 &amp;&amp; header.hasOwnProperty(key)){
        acc[key] = header[key];
      }
      return acc;
    },this);
  }else{
    return this;
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  nJwt.verify(invalidJwt,function(err){
    assert.equal(err.jwtString, invalidJwt);
    done();
  });
});

it('should return PARSE_ERROR if the body is not JSON',function(){
  var header = nJwt.<span class="apidocCodeKeywordSpan">JwtHeader</span>({type:'JWT',alg:'HS256'}).compact();
  assert.throws(function(){
    nJwt.verify(header+".notavalidbody");
  },properties.errors.PARSE_ERROR);
});

it('should give me the parsed header on the error object if the body fails',function(done){
  var header = nJwt.JwtHeader({typ:'JWT',alg:uuid()});
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.njwt.JwtHeader.prototype" id="apidoc.module.njwt.JwtHeader.prototype">module njwt.JwtHeader.prototype</a></h1>


    <h2>
        <a href="#apidoc.element.njwt.JwtHeader.prototype.compact" id="apidoc.element.njwt.JwtHeader.prototype.compact">
        function <span class="apidocSignatureSpan">njwt.JwtHeader.prototype.</span>compact
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function compact(){
  return base64urlEncode(JSON.stringify(this));
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
### 0.2.3

Fixed to prevent the `jti` and `iat` claims of the passed token from being
over-written with default random values during verification.

### 0.2.2

`jwt.toString()` is now an alias for `jwt.<span class="apidocCodeKeywordSpan">compact</span>()`.

### 0.2.1

When parsing a JWT string, the header values of the JWT are now populated on the
object that is returned.

### 0.2.0
...</pre></li>
    </ul>




</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.njwt.Verifier" id="apidoc.module.njwt.Verifier">module njwt.Verifier</a></h1>


    <h2>
        <a href="#apidoc.element.njwt.Verifier.Verifier" id="apidoc.element.njwt.Verifier.Verifier">
        function <span class="apidocSignatureSpan">njwt.</span>Verifier
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function Verifier(){
  if(!(this instanceof Verifier)){
    return new Verifier();
  }
  this.setSigningAlgorithm('HS256');
  this.setKeyResolver(defaultKeyResolver.bind(this));
  return this;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
var uuid = require('uuid');

var nJwt = require('../');
var properties = require('../properties.json');

describe('Verifier', function() {
  it('should construct itself if called without new', function() {
assert(nJwt.<span class="apidocCodeKeywordSpan">Verifier</span>() instanceof nJwt.Verifier);
  });

  describe('.withKeyResolver()', function() {
var resolver;

before(function() {
  resolver = function() {};
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.njwt.Verifier.prototype" id="apidoc.module.njwt.Verifier.prototype">module njwt.Verifier.prototype</a></h1>


    <h2>
        <a href="#apidoc.element.njwt.Verifier.prototype.isSupportedAlg" id="apidoc.element.njwt.Verifier.prototype.isSupportedAlg">
        function <span class="apidocSignatureSpan">njwt.Verifier.prototype.</span>isSupportedAlg
        <span class="apidocSignatureSpan">(alg)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function isSupportedAlg(alg){
  return !!algCryptoMap[alg];
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  return this;
};
Jwt.prototype.setSigningKey = function setSigningKey(key) {
  this.signingKey = key;
  return this;
};
Jwt.prototype.setSigningAlgorithm = function setSigningAlgorithm(alg) {
  if(!this.<span class="apidocCodeKeywordSpan">isSupportedAlg</span>(alg)){
    throw new JwtError(properties.errors.UNSUPPORTED_SIGNING_ALG);
  }
  this.header.alg = alg;
  return this;
};

Jwt.prototype.sign = function sign(payload, algorithm, cryptoInput) {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.njwt.Verifier.prototype.setKeyResolver" id="apidoc.element.njwt.Verifier.prototype.setKeyResolver">
        function <span class="apidocSignatureSpan">njwt.Verifier.prototype.</span>setKeyResolver
        <span class="apidocSignatureSpan">(keyResolver)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function setKeyResolver(keyResolver) {
  this.keyResolver = keyResolver.bind(this);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
};

function Verifier(){
if(!(this instanceof Verifier)){
  return new Verifier();
}
this.setSigningAlgorithm('HS256');
this.<span class="apidocCodeKeywordSpan">setKeyResolver</span>(defaultKeyResolver.bind(this));
return this;
}
Verifier.prototype.setSigningAlgorithm = function setSigningAlgorithm(alg) {
if(!this.isSupportedAlg(alg)){
  throw new JwtError(properties.errors.UNSUPPORTED_SIGNING_ALG);
}
this.signingAlgorithm = alg;
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.njwt.Verifier.prototype.setSigningAlgorithm" id="apidoc.element.njwt.Verifier.prototype.setSigningAlgorithm">
        function <span class="apidocSignatureSpan">njwt.Verifier.prototype.</span>setSigningAlgorithm
        <span class="apidocSignatureSpan">(alg)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function setSigningAlgorithm(alg) {
  if(!this.isSupportedAlg(alg)){
    throw new JwtError(properties.errors.UNSUPPORTED_SIGNING_ALG);
  }
  this.signingAlgorithm = alg;
  return this;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
return new Jwt(claims, enforceDefaultFields);
  }

  this.header = new JwtHeader();
  this.body = new JwtBody(claims);

  if (enforceDefaultFields !== false) {
this.<span class="apidocCodeKeywordSpan">setSigningAlgorithm</span>('none');

if (!this.body.jti) {
  this.setJti(uuid.v4());
}

if (!this.body.iat) {
  this.setIssuedAt(nowEpochSeconds());
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.njwt.Verifier.prototype.setSigningKey" id="apidoc.element.njwt.Verifier.prototype.setSigningKey">
        function <span class="apidocSignatureSpan">njwt.Verifier.prototype.</span>setSigningKey
        <span class="apidocSignatureSpan">(keyStr)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function setSigningKey(keyStr) {
  this.signingKey = keyStr;
  return this;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
var args = Array.prototype.slice.call(arguments);
var cb = typeof args[args.length-1] === 'function' ? args.pop() : null;

var verifier = new Verifier();

if(args.length===3){
  verifier.setSigningAlgorithm(args[2]);
  verifier.<span class="apidocCodeKeywordSpan">setSigningKey</span>(args[1]);
}

if(args.length===2){
  verifier.setSigningKey(args[1]);
}

if(args.length===1){
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.njwt.Verifier.prototype.verify" id="apidoc.element.njwt.Verifier.prototype.verify">
        function <span class="apidocSignatureSpan">njwt.Verifier.prototype.</span>verify
        <span class="apidocSignatureSpan">(jwtString, cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function verify(jwtString, cb){
  var jwt;

  var done = handleError.bind(null,cb);

  try {
    jwt = new Parser().parse(jwtString);
  } catch(e) {
    return done(e);
  }

  var body = jwt.body;
  var header = jwt.header;
  var signature = jwt.signature;

  var cryptoAlgName = algCryptoMap[header.alg];
  var signingType = algTypeMap[header.alg];

  if (header.alg !== this.signingAlgorithm) {
    return done(new JwtParseError(properties.errors.SIGNATURE_ALGORITHM_MISMTACH,jwtString,header,body));
  }

  if (jwt.isExpired()) {
    return done(new JwtParseError(properties.errors.EXPIRED,jwtString,header,body));
  }

  if (jwt.isNotBefore()) {
    return done(new JwtParseError(properties.errors.NOT_ACTIVE,jwtString,header,body));
  }

  var digstInput = jwt.verificationInput;
  var verified, digest;

  return this.keyResolver(header.kid, function(err, signingKey) {

    if (err) {
      return done(new JwtParseError(util.format(properties.errors.KEY_RESOLVER_ERROR, header.kid),jwtString,header,body, err));
    }


    if( cryptoAlgName==='none') {
      verified = true;
    } else if(signingType === 'hmac') {
      digest = crypto.createHmac(cryptoAlgName, signingKey)
        .update(digstInput)
        .digest('base64');
      verified = signature === digest;
    } else {
      var unescapedSignature;
      var signatureType = undefined;

      if (isECDSA(header.alg)) {
        try {
          unescapedSignature = ecdsaSigFormatter.joseToDer(signature, header.alg);
        } catch (err) {
          return done(new JwtParseError(properties.errors.SIGNATURE_MISMTACH,jwtString,header,body,err));
        }
      } else {
        signatureType = 'base64';
        unescapedSignature = base64urlUnescape(signature);
      }

      verified = crypto.createVerify(cryptoAlgName)
        .update(digstInput)
        .verify(signingKey, unescapedSignature, signatureType);
    }

    var newJwt = new Jwt(body, false);

    newJwt.toString = function () {
      return jwtString;
    };

    newJwt.header = new JwtHeader(header);

    if (!verified) {
      return done(new JwtParseError(properties.errors.SIGNATURE_MISMTACH,jwtString,header,body));
    }

    return done(null, newJwt);
  });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

### 0.3.1

Fixed to support proper signing and verification of ECDSA signatures.

### 0.3.0

The JWTs that are returned by `nJwt.<span class="apidocCodeKeywordSpan">verify</span>()` and `nJwt.parse()` will no longer
populate the `iat` and `jti` fields with default random values.

### 0.2.3

Fixed to prevent the `jti` and `iat` claims of the passed token from being
over-written with default random values during verification.
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.njwt.Verifier.prototype.withKeyResolver" id="apidoc.element.njwt.Verifier.prototype.withKeyResolver">
        function <span class="apidocSignatureSpan">njwt.Verifier.prototype.</span>withKeyResolver
        <span class="apidocSignatureSpan">(keyResolver)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function withKeyResolver(keyResolver) {
  this.keyResolver = keyResolver;
  return this;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...



# nJwt Change Log

### 0.4.0

* Added a key resolver interface, use `nJwt.createVerifier().<span class="apidocCodeKeywordSpan">withKeyResolver</span>(function
(kid, cb){ })`
* Added `jwt.setClaim(claim, value)` and `jwt.setHeader(param, value)` for setting body claims and header values in a chain-able
 way.

### 0.3.2

Added support for the `nbf`, "not before", claim.

### 0.3.1
...</pre></li>
    </ul>


</div>

<div class="apidocFooterDiv">
    [ this document was created with
    <a href="https://github.com/kaizhu256/node-utility2" target="_blank">utility2</a>
    ]
</div>
</div>
</body></html>